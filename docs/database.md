# æ•°æ®åº“æ“ä½œ

> ç¼ºå°‘äº†æ•°æ®åº“ç›¸å…³çš„æ“ä½œï¼ŒåŽç«¯å¼€å‘å°†ç¼ºå°‘äº†æ„ä¹‰ã€‚

## æ•°æ®åº“é€‰æ‹©

å¸‚é¢ä¸Šæœ‰å¾ˆå¤šä¼˜ç§€çš„æ•°æ®åº“ï¼Œå®ƒä»¬çš„å­˜åœ¨æ€»æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ²¡æœ‰ç»å¯¹å¥½çš„ç³»ç»Ÿï¼Œåªæœ‰é€‚åˆè‡ªå·±é¡¹ç›®çš„ç³»ç»Ÿã€‚

LyApi 2.X é‡‡ç”¨äº†æ–¹ä¾¿ç®€æ´çš„ Medoo æ“ä½œåº“ï¼Œå®ƒæ”¯æŒäº†å¾ˆå¤šå¸‚é¢ä¸Šçƒ­é—¨çš„æ•°æ®åº“ç³»ç»Ÿï¼š

- MySQL, MariaDB -> php_pdo_mysql
- MSSQL (Windows) -> php_pdo_sqlsrv
- MSSQL (Liunx/UNIX) -> php_pdo_dblib / php_pdo_sqlsrv
- Oracle -> php_pdo_oci
- Oracle version 8 -> php_pdo_oci8
- SQLite -> php_pdo_sqlite
- PostgreSQL -> php_pdo_pgsql
- Sybase -> php_pdo_dblib

å®ƒä»¬éƒ½æ˜¯å…³ç³»åž‹æ•°æ®åº“ç³»ç»Ÿï¼Œä½†å¸‚é¢ä¸Šè¿˜æœ‰ä¸€ç§éžå…³ç³»åž‹çš„æ•°æ®åº“ç±»åž‹ï¼š

- MongoDB
- Cassandra
- Memcached
- HBase
- Redis
- ...

#### å…³ç³»åž‹ å’Œ éžå…³ç³»åž‹

å†™è¿‡ PHP çš„åº”è¯¥éƒ½çŸ¥é“ MySQL å§ï¼Œå®ƒçš„æ•°æ®éƒ½æ˜¯å­˜åœ¨ä¸€ä¸ªä¸ªæ•°æ®è¡¨ä¸­çš„ï¼Œè€Œæ•°æ®è¡¨éƒ½æ˜¯è¡¨é¡¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åªèƒ½åœ¨æ•°æ®é¡¹çš„é™åˆ¶ä¸‹æ‰èƒ½æ’å…¥æ•°æ®ï¼šå¦‚æžœ â€œUserNameâ€ çš„æ•°æ®é¡¹ç±»åž‹ä¸ºå­—ç¬¦ä¸²ï¼Œé‚£ä½ å°±ä¸èƒ½ç›´æŽ¥å°†ä¸€ä¸ªæ•°å­—æ’å…¥è¿›åŽ»ã€‚â€”â€” ç®€å•åœ°è¯´å°±æ˜¯æœ‰ä¸¥æ ¼é™åˆ¶æ ¼å¼ã€‚

è€Œéžå…³ç³»åž‹æ•°æ®åº“ï¼Œå¦‚ Mongodb åˆ™ä¸ä¼šæœ‰å¾ˆä¸¥æ ¼çš„é™åˆ¶ï¼ŒMongodbæ˜¯æ–‡æ¡£å¼çš„å‚¨å­˜æ–¹å¼ï¼Œåœ¨ä¸€æ¡æ•°æ®è¡¨ä¸‹ï¼Œä½ çš„æ¯æ¡æ•°æ®çš„æ ¼å¼éƒ½æ˜¯å¯ä»¥éšæ„å˜åŒ–çš„ã€‚æ¯”å¦‚è¯´ä¸€ä¸ª â€œuser_tableâ€ ä¸¤æ¡æ•°æ®æœ‰çš„æ•°æ®é¡¹å¯ä»¥å®Œå…¨ä¸ä¸€æ ·ï¼Œç¬¬ä¸€æ¡æœ‰çš„å±žæ€§ï¼Œç¬¬äºŒæ¡å¯ä»¥æ²¡æœ‰ã€‚ â€”â€” ç®€å•è¯´å°±æ˜¯æ²¡é™åˆ¶ã€‚

è¿™ä¸¤ç§ç±»åž‹çš„æ•°æ®åº“ä¸å­˜åœ¨å¥½ä¸Žåçš„åŒºåˆ†ï¼Œå®ƒä»¬é€‚åˆçš„æ˜¯ä¸åŒçš„é¡¹ç›®ç±»åž‹ã€‚

ä¸€èˆ¬æ­£å¸¸çš„é¡¹ç›®ä½¿ç”¨ MySQL è¶³çŸ£ï¼Œä½†å¦‚æžœä½ çš„é¡¹ç›®æ•°æ®ç»“æž„æ˜¯åœ¨ä¸æ–­å˜åŒ–çš„ï¼Œå°±å¯ä»¥è€ƒè™‘éžå…³ç³»åž‹æ•°æ®åº“äº†ã€‚

## æ•°æ®åº“è¿žæŽ¥

LyApi 2.X å°è£…äº†ç‰¹æ®Šçš„æ•°æ®åº“è¿žæŽ¥æ–¹å¼ï¼Œä½ éœ€è¦åœ¨ application/Config/database.php ä¸‹è¿›è¡Œé…ç½®ï¼š

```php
return [
    "mydb" => [
        'server' => '127.0.0.1',
        'username' => 'root',
        'password' => 'root',
        'database_name' => 'mysql',
        'charset' => 'utf8',
        'database_type' => 'mysql'
    ]
];
```

ä½ å¯ä»¥åœ¨è¿™é‡Œè¿”å›žæ‰€æœ‰ä¼šç”¨åˆ°çš„æ•°æ®åº“è¿žæŽ¥é…ç½®ï¼Œæ¡†æž¶ä¼šæ ¹æ®åœ¨ä½¿ç”¨æ—¶çš„é€‰æ‹©è‡ªåŠ¨è¿žæŽ¥åˆ°ç›¸åº”çš„æ•°æ®åº“ã€‚

é€šè¿‡ Connector å¯¹è±¡å–å¾— Medoo è¿žæŽ¥ï¼š

```php

$ctor = new Connector(); 
$conn = $ctor->mydb;
// --------- åˆ†å‰²çº¿ --------- //
$conn = Connector::connect("mydb");
```

ä¸Šæ–¹æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥èŽ·å–åˆ°æ•°æ®åº“è¿žæŽ¥ï¼ˆå‰ææ˜¯æœ‰ç›¸åº” Key çš„é…ç½®ï¼‰


## æ•°æ®åº“æ“ä½œ

è™½ç„¶è¯´åŽç«¯æ¶‰åŠåˆ°å¾ˆå¤šçŸ¥è¯†ï¼Œä½†å½’æ ¹ç»“åº•ï¼Œæˆ‘ä»¬æ‰€å®Œæˆçš„ä»»åŠ¡åŸºæœ¬ä¸Šå°±æ˜¯ **CURD** ï¼

CURDå³ï¼šCreate Update Read Delete (å¢žåˆ æ”¹æŸ¥)

æ‰€ä»¥è¯´æ•°æ®åº“çš„æ“ä½œåœ¨åŽç«¯å¼€å‘ä¸­æ˜¯è‡³å…³é‡è¦æ»´ ðŸ¤ 

!> ä¸‹æ–¹æ–‡æ¡£ä»…æä¾›ç®€å•æ¼”ç¤ºï¼Œå®Œæ•´æ–‡æ¡£è¯·ç§»æ­¥ï¼š[Medoo Database Framework](https://medoo.in/doc)

### æ•°æ®æ’å…¥

æ•°æ®åº“ä¸­çš„æ¯æ¡æ•°æ®éƒ½æ˜¯ç¨‹åºæ’å…¥ï¼ˆåˆ›å»ºï¼‰çš„ï¼Œæ‰€ä»¥å®ƒè‡³å…³é‡è¦ï¼

```php
// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ“ä½œçš„è¡¨åï¼ˆMedoo æ‰€æœ‰æ“ä½œç¬¬ä¸€å‚æ•°éƒ½ä¸ºè¡¨åï¼‰
$conn->insert("my_table",[
    
    // ç¬¬äºŒå‚æ•°åˆ™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºŽè®¾ç½®ç›¸å…³çš„å±žæ€§
    // å¦‚æžœè¡¨ç»“æž„è®¾ç½®å¯ç©ºæˆ–é»˜è®¤å€¼ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®
    
    'username' => 'liuzhuoer',
    'password' => '123456789'
]);
```

### æ•°æ®æŸ¥è¯¢

!> æŸ¥è¯¢å‡½æ•°è¿‡äºŽå¤æ‚ï¼Œå»ºè®®å‰å¾€ [Medoo å®˜ç½‘](https://medoo.in/doc) æŸ¥çœ‹!

å…ˆæ¥ä¸ªåŸºç¡€çš„æŸ¥è¯¢æ“ä½œï¼š

```php
// ä¸€èˆ¬ä¼šä½¿ç”¨åˆ°çš„æœ‰ä¸‰ä¸ªå‚æ•°ï¼š

// ç¬¬ä¸€ä¸ªï¼šè¡¨å
// ç¬¬äºŒä¸ªï¼šæŸ¥è¯¢å­—æ®µåï¼ˆå³éœ€è¦çš„ç»“æžœæœ‰å“ªäº›å­—æ®µï¼‰
// ç¬¬ä¸‰ä¸ªï¼šæ¡ä»¶ï¼ˆç›¸å½“äºŽSQLä¸­çš„ Where ï¼‰

// æŸ¥è¯¢ id ä¸º 1 çš„æ•°æ®ï¼Œåªè¦ username å’Œ email ä¸¤ä¸ªå€¼
$data = $conn->select("my_table", [
	"username",
	"email"
], [
	"id" => 1
]);
```

æŽ¥ä¸‹æ¥æ˜¯ç¨å¾®é«˜çº§çš„æ“ä½œï¼š


```php
// æŸ¥è¯¢å­—æ®µä¸º * å³ä»£è¡¨å–å¾—æ‰€æœ‰å­—æ®µä¿¡æ¯
// age[>] ç›¸å½“äºŽæŸ¥è¯¢ age å¤§äºŽ 18 çš„ä¿¡æ¯

$data = $conn->select("my_table", "*", [
    "age[>]" => 18
]);
```

select å‡½æ•°å¯èƒ½æŸ¥è¯¢å¤šæ¡æ•°æ®ï¼Œå¦‚æžœä½ åªè¦ä¸€æ¡ï¼Œè¯·ä½¿ç”¨ **get** å‡½æ•°ï¼š

```php
// ç»“æž„å’Œä¸Šæ–¹ä»£ç ä¸€æ ·ï¼Œä½†æœ¬æ¬¡åªå–å¾—ç¬¬ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„æ•°æ®
$data = $conn->get("my_table", "*", [
    "age[>]" => 18
]);
```


### æ›´æ–°æ•°æ®

!> æ›´æ–°å‡½æ•°è¿‡äºŽå¤æ‚ï¼Œå»ºè®®å‰å¾€ [Medoo å®˜ç½‘](https://medoo.in/doc) æŸ¥çœ‹!

```php

// ç¬¬äºŒä½å‚æ•°ä¸ºæ›´æ–°çš„æ•°æ®
// ç¬¬ä¸‰ä½å‚æ•°åŒSQL Where

$conn->update("my_table",[

    // å…ˆå°† Email æ›´æ–°ä¸º mrxzx@qq.com
    // ç„¶åŽ Age = Age + 1 ï¼ˆç›¸å½“äºŽè‡ªå¢žï¼‰

    "email" => "mrxzx@qq.com",
    "age[+]" => 1
],[
    "username" => 'liuzhuoer'
]);
```

### åˆ é™¤æ•°æ®

```php

// ç¬¬äºŒä½å‚æ•°ç›¸å½“äºŽ SQL Where

$conn->update("my_table",[

    // åˆ é™¤ç”¨æˆ·åä¸º liuzhuoer çš„æ•°æ®

    "username" => 'liuzhuoer'
]);
```